<html>
<head>
<meta charset="utf-8">
<!-- Load d3.js and the geo projection plugin -->
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin="India"/>
<script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin="India"></script>
<style>
html { overflow-y: hidden; }
* {
  margin: 0;
  padding: 0;
}
#mapid { height: 88%;width: 98%;margin-left: auto; margin-right: auto;}
table, th, td {
  border: 0px solid white;
  border-collapse: collapse;
  color:white;
}
table{
 border-collapse: separate;
  border-spacing: 20px;
  }
 
 #my_table{
  border: 0px solid white;
  border-collapse: collapse;
   border-spacing: 50px;
 }
body {
    background-color: #1a202a;}

#reset_filter{
  background-color: #03C0C1; /* Green */
  border: none;
  color: black;
  padding: 10px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  position: absolute;
  right: 20;
  border-radius:20px;
  box-shadow: 0 5px #666;
  transform: translateY(4px);
}
#days{
  background-color: #03C0C1;
  border: none;
  color: black;
  padding: 5px 5px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  position: absolute;
  right: 600;
  border-radius:20px;
  transform: translateY(4px);
  text-align-last:center;
}

#reset_filter:hover {
  color: white;
  background-color: #0a6967;
  box-shadow: 0 5px #666;
  transform: translateY(4px);
}
.selected {
  fill: red; !important
}
</style>
</head>
<body>
<h2 style="text-align:center;font-family: Verdana, sans-serif;color:white;margin-bottom: 0;padding-top:5px">San Francisco Incident Report Dashboard<button id="reset_filter" onClick="reset_filter()">Reset Filter</button></h2>
<table style="height:95%;width:100%" >
  <tr>
    <td style="text-align: center;font-size:20px;font-family:  Verdana, sans-serif;box-shadow: 5px 10px #151819;background-color: #252525;" width="37%" height="55%" ><div style="padding-bottom:7px">All Incident Reported in San Francisco</div><svg id="mapid" style="padding-bottom:7px"></svg></td>
    <td style="text-align: center;font-size:20px;font-family:  Verdana, sans-serif;box-shadow: 5px 10px #151819;background-color: #252525;" width="37%" height="55%"><div style="padding-bottom:7px"></div>Number of Incidents Reported per year<div id="line_chart" style="padding-bottom:7px"></div></td>
    <td style="text-align: center;font-size:20px;font-family:  Verdana, sans-serif;box-shadow: 5px 10px #151819;background-color: #252525;" width="26%" height="90%" rowspan="2"><div style="padding-bottom:7px">Top 10 Incident Category Reported</div><div id="lollipop_chart"></div></td>
  </tr>
  <tr>
    <td style="text-align: center;font-size:20px;font-family:  Verdana, sans-serif;box-shadow: 5px 10px #151819;background-color: #252525;" width="20%" height="45%" rowspan="2" ><div style="padding-top:20px"></div>Number of Incident Reported per District<div id="piechart"></div></td>
    <td style="text-align: center;font-size:20px;font-family:  Verdana, sans-serif;box-shadow: 5px 10px #151819;background-color: #252525;" width="35%" height="45%" rowspan="2">Density of Incidents Reported for each hour
    <div id="areachart"></div></td> 
  </tr>
  <tr>
    <td style="text-align: center;font-size:20px;font-family:  Verdana, sans-serif;box-shadow: 5px 10px #151819;background-color: #252525;" width="26%" height="10%">
    <div style="padding-top:10px">
        <table style="width:100%;height:100%;" id="my_table" >
        <tr>
            <th style="text-align:center;font-size:20px;font-family:  Verdana;padding-bottom: 1em" colspan="2">Incident Statistics</th>
        </tr>
         <tr>
             <th style="text-align:center;font-size:20px;font-family:  Verdana" colspan="2"></th>
         </tr>
        <tr>
            <td style="text-align:center;font-size:16px;font-family:  Verdana" colspan="2">Total Number of Incidents Reported</td>
        </tr>
        <tr>
            <td style="text-align:center;font-size:28px;font-family:  Verdana;padding-bottom: 1em;color: #03c0c1;" colspan="2"><b><p id="total_cases"></p></b></td>
        </tr>
        <tr>
            <td style="text-align:center;font-size:16px;font-family:  Verdana">Open or Active Incidents</td>
            <td style="text-align:center;font-size:16px;font-family:  Verdana">Closed Incidents</td>
        </tr>
        <tr>
            <td style="text-align:center;font-size:28px;font-family:  Verdana;padding-bottom: 1em;color: #03c0c1;"><b><p id="open_cases"></p></b></td>
            <td style="text-align:center;font-size:28px;font-family:  Verdana;padding-bottom: 1em;color: #03c0c1;"><b><p id="adult_cases"></p></b></td>
        </tr>
        <tr>
            <td style="text-align:center;font-size:16px;font-family:  Verdana">Cleared Exceptional Incidents</td>
            <td style="text-align:center;font-size:16px;font-family:  Verdana">Unfounded Incidents</td>
        </tr>
        <tr>
            <td style="text-align:center;font-size:28px;font-family:  Verdana;padding-bottom: 1em;color: #03c0c1;"><b><p id="exceptional_cases"></p></b></td>
            <td style="text-align:center;font-size:28px;font-family:  Verdana;padding-bottom: 1em;color: #03c0c1;"><b><p id="unfound_cases"></p></b></td>
        </tr>
        <tr>
            <td style="text-align:center;font-size:16px;font-family:  Verdana" colspan="2">Incidents Filed Online</td>
        </tr>
        <tr>
            <td style="text-align:center;font-size:28px;font-family:  Verdana;padding-bottom: 1em;color: #03c0c1;" colspan="2"><b><p id="online"></p></b></td>
        </tr>
        </table>
    </div></td>
  </tr>
</table>

</body>
<script>
window.onload = function()
{
	Pie_chart_data();
	Map_chart_data();
	line_chart_data();
	lollipop_chart_data();
	stats_chart_data();
	area_chart_data();
}
function reset_filter()
{
    	Pie_chart_data();
    	Map_chart_data();
    	line_chart_data();
    	lollipop_chart_data();
    	stats_chart_data();
}

function Map_chart_data(){
fetch('/Map_chart')
      .then(function (response) {
          return response.json();
      }).then(function (response) {
            output = JSON.parse(JSON.stringify(response))
            Geo_map(output.data)
      });

}

function Map_chart_pie_data(d){
    fetch('/Map_Chart_pie',{method: "post",
      headers : { 
            'Content-Type': 'application/json',
            'Accept': 'application/json'
           },
      body: JSON.stringify({post:d})})
          .then(function (response) {
              return response.json();
          }).then(function (output) {
               records = JSON.parse(JSON.stringify(output))
               Geo_map(records.data)
       });       
}

function Map_Chart_lollipop_data(d){
    fetch('/Map_Chart_lollipop',{method: "post",
      headers : { 
            'Content-Type': 'application/json',
            'Accept': 'application/json'
           },
      body: JSON.stringify({post:d})})
          .then(function (response) {
              return response.json();
          }).then(function (output) {
               records = JSON.parse(JSON.stringify(output))
               Geo_map(records.data)
       });       
}

function Map_Chart_line_data(d){
    fetch('/Map_Chart_line',{method: "post",
      headers : { 
            'Content-Type': 'application/json',
            'Accept': 'application/json'
           },
      body: JSON.stringify({post:d})})
          .then(function (response) {
              return response.json();
          }).then(function (output) {
               records = JSON.parse(JSON.stringify(output))
               Geo_map(records.data)
       });       
}

      
function Geo_map(data_1){
    
   d3.select("svg").html("");
   
   var width = 680
   height = 550

   var svg = d3.select("#mapid").append("svg").attr("width", width).attr("height", height).call(d3.zoom().on("zoom", function () {
       svg.attr("transform", d3.event.transform)
    }))
  .append("g")

    //var svg = d3.select("svg"),width = +svg.attr("width"),height = +svg.attr("height");

    var projection = d3.geoMercator().center([-122.450, 37.758]) .scale(170000).translate([ width/2, height/2 ])

    d3.json("static/data/SF Find Neighborhoods.geojson", function(data){

        
        svg.append("g").selectAll("path")
         .data(data.features)
         .enter().append("path").attr("fill", "white")
         .attr("d", d3.geoPath().projection(projection))
         .style("stroke", "black").attr("fill-opacity",0.8)
         
        
        svg.append("g")
    .selectAll("circle")
      .data(data_1)
      .enter()
      .append("circle")
        .attr("cx", function(d){ return projection([d.Longitude, d.Latitude])[0] })
        .attr("cy", function(d){ return projection([d.Longitude, d.Latitude])[1] })
        .attr("r", 3)
        .style("fill", "#03c0c1")
        .attr("stroke", "#000000")
        .attr("stroke-width", 1)
        .attr("fill-opacity",1)     
        
    })
}

function Pie_chart_data(){
fetch('/Pie_chart')
      .then(function (response) {
          return response.json();
      }).then(function (response) {
            output = JSON.parse(JSON.stringify(response))
            Pie_chart(output.values)
      });

}

function Pie_chart_data_lillipop(d){
    fetch('/Pie_chart_lillipop',{method: "post",
      headers : { 
            'Content-Type': 'application/json',
            'Accept': 'application/json'
           },
      body: JSON.stringify({post:d})})
          .then(function (response) {
              return response.json();
          }).then(function (output) {
               records = JSON.parse(JSON.stringify(output))
               Pie_chart(records.data)
       });       
}

function Pie_chart_data_line_chart(d){
    fetch('/Pie_chart_line_chart',{method: "post",
      headers : { 
            'Content-Type': 'application/json',
            'Accept': 'application/json'
           },
      body: JSON.stringify({post:d})})
          .then(function (response) {
              return response.json();
          }).then(function (output) {
               records = JSON.parse(JSON.stringify(output))
               Pie_chart(records.data)
       });       
}


function Pie_chart(array)
{
    d3.select("#piechart").html("");
    var data = array.reduce((obj, item) => Object.assign(obj, { [item.year]: item.counts }), {});
    var width = 550
    height = 390
    margin = 40
    var radius = Math.min(width, height) / 2 - margin

    var svg = d3.select("#piechart").append("svg").attr("width", width)
    .attr("height", height).append("g").attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

    var color = d3.scaleOrdinal().domain([0,10]).range(["#CB793A","#847E89","#E8E1EF","#ECFFB0","#A40E4C","#E952DE","#726DA8","#F42C04","#FEEA00","#4059AD","#8B80F9","#C1666B"]);

    var pie = d3.pie().sort(null).value(function(d) {return d.value; })
    var data_ready = pie(d3.entries(data))

    var arc = d3.arc().innerRadius(radius * 0.5).outerRadius(radius * 0.8)
    var arcOver = d3.arc().innerRadius(radius * 0.55).outerRadius(radius * 0.85)

    var outerArc = d3.arc().innerRadius(radius * 0.9).outerRadius(radius * 0.9)
    
    var tooldiv = d3.select("#piechart")
		.append('div').style('visibility','hidden').style('position','absolute')
						  
  
    svg.selectAll('allSlices').data(data_ready).enter().append('path')
      .attr('d', arc).attr('fill', function(d){ return(color(d.data.key)) }).attr("stroke", "white")
      .style("stroke-width", "2px").style("opacity", 0.6).style("font-family","Verdana, sans-serif").on("click",function(d){
              svg.selectAll("path").transition().style("opacity", 0.2).attr("d", arc);
              d3.select(this).transition().style("opacity", 1).attr("d", arcOver);
              var year_num=d.data.key
              console.log(year_num);
              Map_chart_pie_data(year_num);
              SelectedValue_pie(year_num);
              SelectedValue_lollipop_pie(year_num);
              stats_pie_chart(year_num);
              area_pie_chart(year_num);
              }).on('mouseover', (e,f)=>{
					console.log(e)
					console.log(f)
					tooldiv.style('visibility','visible').style("color", "white").style("font-size","19px").style("font-weight","bold")
					.style("font-family","Verdana, sans-serif").style("color","#03c0c1")
							.html(e.data.value+"<br>"+"Incidents")
							
				})
				.on('mousemove', (e,f)=>{
					tooldiv.style('top', '810px')
							.style('left', '355px')
				})
				.on('mouseout',()=>{
					tooldiv.style('visibility','hidden')
				})
              
    svg.selectAll('allPolylines').data(data_ready)
      .enter().append('polyline').attr("stroke", "white").style("fill", "none")
      .attr("stroke-width", 1).style("font-family","Verdana, sans-serif").attr('points', function(d) {
          var posA = arc.centroid(d) // line insertion in the slice
          var posB = outerArc.centroid(d) // line break: we use the other arc generator that has been built only for that
          var posC = outerArc.centroid(d); // Label position = almost the same as posB
          var midangle = d.startAngle + (d.endAngle - d.startAngle) / 2 // we need the angle to see if the X position will be at the extreme right or extreme left
          posC[0] = radius * 0.95 * (midangle < Math.PI ? 1 : -1); // multiply by 1 or -1 to put it on the right or on the left
          return [posA, posB, posC]
        })

    svg.selectAll('allLabels').data(data_ready).enter()
      .append('text').text( function(d) { return d.data.key } )
      .attr('transform', function(d) {
        var pos = outerArc.centroid(d);
        var midangle = d.startAngle + (d.endAngle - d.startAngle) / 2
        pos[0] = radius * 0.99 * (midangle < Math.PI ? 1 : -1);
        return 'translate(' + pos + ')';
        }).style("font-family","Verdana, sans-serif").style("font", "19px times")
     .style('text-anchor', function(d) {
        var midangle = d.startAngle + (d.endAngle - d.startAngle) / 2
        return (midangle < Math.PI ? 'start' : 'end')
        }).attr("stroke", "white")   
}

function line_chart_data(){
fetch('/line_chart')
      .then(function (response) {
          return response.json();
      }).then(function (response) {
            output = JSON.parse(JSON.stringify(response))
            line_chart(output.data)
      });

}

function SelectedValue_pie(d){
    fetch('/line_chart_pie',{method: "post",
      headers : { 
            'Content-Type': 'application/json',
            'Accept': 'application/json'
           },
      body: JSON.stringify({post:d})})
          .then(function (response) {
              return response.json();
          }).then(function (output) {
               records = JSON.parse(JSON.stringify(output))
               line_chart(records.data)
       });       
}

function SelectedValue_lillipop(d){
    fetch('/line_chart_lillipop',{method: "post",
      headers : { 
            'Content-Type': 'application/json',
            'Accept': 'application/json'
           },
      body: JSON.stringify({post:d})})
          .then(function (response) {
              return response.json();
          }).then(function (output) {
               records = JSON.parse(JSON.stringify(output))
               line_chart(records.data)
       });       
}

function line_chart(data)
{    
    d3.select("#line_chart").html("");
    var line_margin = {top: 30, right: 30, bottom: 40, left: 60},
    width = 700 - line_margin.left - line_margin.right,
    height = 480 - line_margin.top - line_margin.bottom;

    var line_svg = d3.select("#line_chart").append("svg").attr("width", width + line_margin.left + line_margin.right)
        .attr("height", height + line_margin.top + line_margin.bottom).append("g")
        .attr("transform", "translate(" + line_margin.left + "," + line_margin.top + ")");
        
    
    var x = d3.scaleLinear().domain(d3.extent(data, function(d) { return d.Incident_Year; })).range([ 0, width ]);
    line_svg.append("g").attr("stroke", "white")
      .attr("transform", "translate(0," + height + ")").style("stroke","white").style("font-family","Verdana, sans-serif")
      .style("font-size","13px")
      .call(d3.axisBottom(x).tickFormat(function(d){
             return d;
         }).ticks(5));

    // Add Y axis
    var y = d3.scaleLinear()
      .domain( [0, d3.max(data, function(d) { return d.counts}) ])
      .range([ height, 0 ]);
    line_svg.append("g").attr("stroke", "white").style("font-family","Verdana, sans-serif")
    .style("font-size","13px")
      .call(d3.axisLeft(y));
      
      var tooldiv = d3.select("#line_chart")
  		.append('div').style('visibility','hidden').style('position','absolute')

    // Add the line
    line_svg.append("path")
      .datum(data)
      .attr("fill", "none")
      .attr("stroke", "white")
      .attr("stroke-width", 1.5)
      .attr("d", d3.line()
        .curve(d3.curveCatmullRom) // Just add that to have a curve instead of segments
        .x(function(d) { return x(d.Incident_Year) })
        .y(function(d) { return y(d.counts) })
        )

    line_svg
      .append("g")
      .selectAll("dot")
      .data(data)
      .enter()
      .append("circle")
        .attr("class", "myCircle")
        .attr("cx", function(d) { return x(d.Incident_Year) } )
        .attr("cy", function(d) { return y(d.counts) } )
        .attr("r", 8)
        .attr("stroke", "#69b3a2")
        .attr("stroke-width", 3)
        .attr("fill", "white").on("click",function(d){
            line_svg.selectAll("circle").transition().style("opacity", 0.2).attr("r", 8).attr("stroke", "#69b3a2").attr("fill", "white");
            line_svg.selectAll("path").transition().style("opacity", 0.2);
            d3.select(this).transition().style("opacity", 1).attr("fill", "#0a6967").attr("stroke", "#ffffff").attr("r", 16);
            var year_num=parseInt(d.Incident_Year)
            console.log(year_num);
            Map_Chart_line_data(year_num);
            SelectedValue_lollipop_line(year_num);
            Pie_chart_data_line_chart(year_num);
            stats_line_chart(year_num);
            area_line_chart(year_num);
            }).on('mouseover', (e,f)=>{
			tooldiv.style('visibility','visible').style("color", "white").style("font-size","17px").style("font-weight","bold")
			.style("font-family","Verdana, sans-serif").style("color","#03c0c1")
					.html(e.counts)
		})
		.on('mousemove', (e,f)=>{
			tooldiv.style('top', (d3.mouse(d3.event.currentTarget)[1]+80) + 'px')
					.style('left', (d3.mouse(d3.event.currentTarget)[0]+875) + 'px')
		})
		.on('mouseout',()=>{
			tooldiv.style('visibility','hidden')
		})
        
}

function lollipop_chart_data(){
fetch('/lollipop_chart')
      .then(function (response) {
          return response.json();
      }).then(function (response) {
            output = JSON.parse(JSON.stringify(response))
            lollipop_chart(output.data)
      });

}

function SelectedValue_lollipop_pie(d){
    fetch('/lollipop_chart_pie',{method: "post",
      headers : { 
            'Content-Type': 'application/json',
            'Accept': 'application/json'
           },
      body: JSON.stringify({post:d})})
          .then(function (response) {
              return response.json();
          }).then(function (output) {
               records = JSON.parse(JSON.stringify(output))
               lollipop_chart(records.data)
       });       
}

function SelectedValue_lollipop_line(d){
    fetch('/lollipop_chart_line_chart',{method: "post",
      headers : { 
            'Content-Type': 'application/json',
            'Accept': 'application/json'
           },
      body: JSON.stringify({post:d})})
          .then(function (response) {
              return response.json();
          }).then(function (output) {
               records = JSON.parse(JSON.stringify(output))
               lollipop_chart(records.data)
       });       
}


function lollipop_chart(data)
{
    d3.select("#lollipop_chart").html("");
    
    var margin = {top: 10, right: 20, bottom: 40, left: 140},
    width = 473 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

    var svg = d3.select("#lollipop_chart").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g").attr("transform","translate(" + margin.left + "," + margin.top + ")");

    data.sort(function(b, a) {return a.counts - b.counts;});
    
    data=data.slice(0,10)

    var x = d3.scaleLinear().domain([0, d3.max(data, function(d) { return d.counts; })]).range([ 0, width]);
    
    svg.append("g").attr("transform", "translate(0," + height + ")").call(d3.axisBottom(x).tickFormat(function(d){
             return d;
         })
         .ticks(5))
      .selectAll("text").attr("transform", "translate(10,0)").style("stroke","white").style("font-family","Verdana, sans-serif")
      .style("font-size","13px").style("text-anchor", "end");

    var y = d3.scaleBand().range([ 0, height ]).domain(data.map(function(d) { return d.Incident_Category; })).padding(1);
    svg.append("g").style("stroke","white").style("fill","none")
    .style("font-family","Verdana, sans-serif").style("font-size","13px").call(d3.axisLeft(y));
    
    var tooldiv = d3.select("#line_chart")
		.append('div').style('visibility','hidden').style('position','absolute')

    svg.selectAll("myline").data(data)
      .enter()
      .append("line").style("stroke","white")
      .attr("x1", function(d) { return x(d.counts); })
      .attr("x2", x(0))
      .attr("y1", function(d) { return y(d.Incident_Category); })
      .attr("y2", function(d) { return y(d.Incident_Category); })
      .attr("stroke", "white")

    svg.selectAll("mycircle")
      .data(data)
      .enter()
      .append("circle")
      .attr("cx", function(d) { return x(d.counts); })
      .attr("cy", function(d) { return y(d.Incident_Category); })
      .attr("r", "8")
      .style("fill", "white")
      .attr("stroke-width", 3)
      .attr("stroke", "#69b3a2").on("click",function(d){
          svg.selectAll("circle").transition().style("opacity", 0.2).attr("r", 8) .style("fill", "white").attr("stroke", "#69b3a2");
           d3.select(this).transition().style("opacity", 1).style("fill", "#0a6967").attr("stroke", "#ffffff").attr("r", 16).attr("stroke-width", 3);
          var year_num=d.Incident_Category
          console.log(year_num);
          Map_Chart_lollipop_data(year_num);
          SelectedValue_lillipop(year_num);
          Pie_chart_data_lillipop(year_num);
          stats_lollipop_chart(year_num);
          area_lollipop_chart(year_num);
          }).on('mouseover', (e,f)=>{
	tooldiv.style('visibility','visible').style("color", "white").style("font-size","17px").style("font-weight","bold")
	.style("font-family","Verdana, sans-serif").style("color","#03c0c1")
			.html(e.counts)
})
.on('mousemove', (e,f)=>{
	tooldiv.style('top', (d3.mouse(d3.event.currentTarget)[1]+70) + 'px')
			.style('left', (d3.mouse(d3.event.currentTarget)[0]+1728) + 'px')
})
.on('mouseout',()=>{
	tooldiv.style('visibility','hidden')
})
}

function stats_line_chart(d){
    fetch('/stats_line_chart',{method: "post",
      headers : { 
            'Content-Type': 'application/json',
            'Accept': 'application/json'
           },
      body: JSON.stringify({post:d})})
          .then(function (response) {
              return response.json();
          }).then(function (response) {
               output = JSON.parse(JSON.stringify(response))
               stats_data(output.data, output.data2, output.data3, output.data4, output.data5)
       });       
}

function stats_lollipop_chart(d){
    fetch('/stats_lollipop_chart',{method: "post",
      headers : { 
            'Content-Type': 'application/json',
            'Accept': 'application/json'
           },
      body: JSON.stringify({post:d})})
          .then(function (response) {
              return response.json();
          }).then(function (response) {
               output = JSON.parse(JSON.stringify(response))
               stats_data(output.data, output.data2, output.data3, output.data4, output.data5)
       });       
}

function stats_pie_chart(d){
    fetch('/stats_pie_chart',{method: "post",
      headers : { 
            'Content-Type': 'application/json',
            'Accept': 'application/json'
           },
      body: JSON.stringify({post:d})})
          .then(function (response) {
              return response.json();
          }).then(function (response) {
               output = JSON.parse(JSON.stringify(response))
               stats_data(output.data, output.data2, output.data3, output.data4, output.data5)
       });       
}

function stats_chart_data(){
fetch('/stats')
      .then(function (response) {
          return response.json();
      }).then(function (response) {
            output = JSON.parse(JSON.stringify(response))
            stats_data(output.data, output.data2, output.data3, output.data4, output.data5)
      });

}

function stats_data(data1, data2, data3, data4, data5)
{
   online_data=data2.map(data2 => data2.counts);
   document.getElementById("online").innerHTML =online_data[0];
   open_cases_data=data3.map(data3 => data3.counts);
   document.getElementById("open_cases").innerHTML =open_cases_data[0];
   adult_cases_data=data4.map(data4 => data4.counts);
   document.getElementById("adult_cases").innerHTML =adult_cases_data[0];
   exceptional_cases_data=data5.map(data5 => data5.counts);
   document.getElementById("exceptional_cases").innerHTML =exceptional_cases_data[0];
   unfound_cases_data=data1.map(data1 => data1.counts);
   document.getElementById("unfound_cases").innerHTML =unfound_cases_data[0];
   document.getElementById("total_cases").innerHTML =unfound_cases_data[0]+exceptional_cases_data[0]+adult_cases_data[0]+open_cases_data[0];
}

function area_chart_data(){
fetch('/area_chart')
         .then(function (response) {
             return response.json();
         }).then(function (response) {
               output = JSON.parse(JSON.stringify(response))
               area_data(output.data)
         });
}

function area_line_chart(d){
    fetch('/area_chart_line_chart',{method: "post",
      headers : { 
            'Content-Type': 'application/json',
            'Accept': 'application/json'
           },
      body: JSON.stringify({post:d})})
          .then(function (response) {
              return response.json();
          }).then(function (response) {
               output = JSON.parse(JSON.stringify(response))
               area_data(output.data)
       });       
}

function area_lollipop_chart(d){
    fetch('/area_chart_lollipop_chart',{method: "post",
      headers : { 
            'Content-Type': 'application/json',
            'Accept': 'application/json'
           },
      body: JSON.stringify({post:d})})
          .then(function (response) {
              return response.json();
          }).then(function (response) {
               output = JSON.parse(JSON.stringify(response))
               area_data(output.data)
       });       
}

function area_pie_chart(d){
    fetch('/area_chart_pie_chart',{method: "post",
      headers : { 
            'Content-Type': 'application/json',
            'Accept': 'application/json'
           },
      body: JSON.stringify({post:d})})
          .then(function (response) {
              return response.json();
          }).then(function (response) {
               output = JSON.parse(JSON.stringify(response))
               area_data(output.data)
       });       
}


function area_data(data){
        d3.select("#areachart").html("");
        var margin = {top: 30, right: 30, bottom: 40, left: 60},
        width = 700 - margin.left - margin.right,
        height = 390 - margin.top - margin.bottom;

        
        var svg = d3.select("#areachart").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform","translate(" + margin.left + "," + margin.top + ")");

        var x = d3.scaleLinear().domain([0, d3.max(data, function(d) { return d.time; })])
        .range([0, width]);
                  
        svg.append("g").style("stroke","white").style("fill","none").style("font-family","Verdana, sans-serif").style("font-size","13px")
          .attr("transform", "translate(0," + height + ")").call(d3.axisBottom(x));
          
        var y = d3.scaleLinear().range([height, 0]).domain([0, 0.10]);
      
        svg.append("g").style("stroke","white").style("fill","none").style("font-family","Verdana, sans-serif").style("font-size","13px")
          .call(d3.axisLeft(y).ticks(5)
              .tickFormat(function(d) {
              return d*1000 + "%";}));
              
        svg.append("text").attr("text-anchor", "end")
          .attr("x", width)
          .attr("y", height + margin.top - 40).style("stroke","white").style("fill","none").style("font-family","Verdana, sans-serif").style("font-size","13px")
          .text("Hour of a Day (24h format)");

        svg.append("text")
          .attr("text-anchor", "end")
          .attr("transform", "rotate(-90)")
          .attr("y", -margin.left+80)
          .attr("x", -margin.top+40).style("stroke","white").style("fill","none").style("font-family","Verdana, sans-serif").style("font-size","13px")
          .text("Density")
        
       var kde = kernelDensityEstimator(kernelEpanechnikov(7), x.ticks(40))
       var density =  kde( data.map(function(d){ return d.time; }) )
      
      svg.append("path")
          .attr("class", "mypath")
          .datum(density)
          .attr("fill", "#252525")
          .attr("opacity", "1")
          .attr("stroke", "#ffffff")
          .attr("stroke-width", 3)
          .attr("stroke-linejoin", "round")
          .attr("d",  d3.line()
            .curve(d3.curveBasis)
              .x(function(d) { return x(d[0]); })
              .y(function(d) { return y(d[1]); })
          );
          
        
        function kernelDensityEstimator(kernel, X) {
          return function(V) {
            return X.map(function(x) {
              return [x, d3.mean(V, function(v) { return kernel(x - v); })];
            });
          };
        }
        function kernelEpanechnikov(k) {
          return function(v) {
            return Math.abs(v /= k) <= 1 ? 0.75 * (1 - v * v) / k : 0;
          };
        }
}






</script>
</html>
